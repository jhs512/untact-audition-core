<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.audictionary.dao.RecruitDao">

	<insert id="doWrite" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO recruitment SET
		regDate = NOW(), updateDate = NOW(),
		memberId = #{memberId},
		title = #{rmTitle},
		`body` = #{rmBody},
		roleType = #{rmRoleType},
		pay = #{rmPay},
		location = #{rmLocation},
		period = #{rmPeriod},
		deadline = #{rmDeadline},
		media = #{awMedia},
		gender = #{rmGender},
		age = #{rmAge},
		script = #{rmScript},
		videoTime = #{rmVideoTime},
		etc = #{rmEtc}
	</insert>
	
	<select id="getListForPrint" resultType="Recruit">
		SELECT * FROM recruitment
		WHERE delStatus != 1
		ORDER BY id DESC
		<if test="limit != null">
			LIMIT #{limit}
		</if>
	</select>
	
	
	<select id="getListForPrintByFilter" resultType="Recruit">
		SELECT r.*, aw.media AS extra__aw_media, aw.title AS extra__aw_title, aw.director AS extra__aw_director, ar.name AS extra__ar_name, ar.character AS extra__ar_character FROM recruitment AS r
		INNER JOIN artwork AS aw
		ON aw.relTypeCode = 'recruitment'
		AND aw.relId = r.id
		INNER JOIN actingRole AS ar
		ON ar.recruitmentId = r.id
		WHERE r.delStatus != 1
		<if test="genderMale != null">
			AND r.gender LIKE CONCAT('%',#{genderMale},'%')
		</if>
		<if test="genderFemale != null">
			AND r.gender LIKE CONCAT('%',#{genderFemale},'%')
		</if>
		<if test="genderNone != null">
			AND r.gender LIKE CONCAT('%',#{genderNone},'%')
		</if>
		<if test="age1 != null">
			AND r.age LIKE CONCAT('%',#{age1},'%')
		</if>
		<if test="age10 != null">
			AND r.age LIKE CONCAT('%',#{age10},'%')
		</if>
		<if test="age20 != null">
			AND r.age LIKE CONCAT('%',#{age20},'%')
		</if>
		<if test="age30 != null">
			AND r.age LIKE CONCAT('%',#{age30},'%')
		</if>
		<if test="age4050 != null">
			AND r.age LIKE CONCAT('%',#{age4050},'%')
		</if>
		<if test="age60 != null">
			AND r.age LIKE CONCAT('%',#{age60},'%')
		</if>
		<if test="genreMv != null">
			AND aw.media LIKE CONCAT('%',#{genreMv},'%')
		</if>
		<if test="genreDrama != null">
			AND aw.media LIKE CONCAT('%',#{genreDrama},'%')
		</if>
		<if test="genreTheater != null">
			AND aw.media LIKE CONCAT('%',#{genreTheater},'%')
		</if>
		<if test="genreIndieMv != null">
			AND aw.media LIKE CONCAT('%',#{genreIndieMv},'%')
		</if>
		<if test="notExpired != null"> 
			AND deadline >= DATE_FORMAT(NOW(), '%Y-%m-%d')
		</if>
		ORDER BY id DESC
		<if test="limit != null">
		LIMIT #{limit}
		</if>
	</select>
	
	<select id="getRecruitById" resultType="Recruit">
		SELECT * FROM recruitment
		WHERE id = #{id}
	</select>
	
	<update id="doModify">
		UPDATE recruitment
		<set>
			<if test="isNeedToModify">
				updateDate = NOW()
			</if>
			<if test="rmTitle != null and rmTitle.length > 0">
				, title = #{rmTitle}
			</if>
			<if test="rmBody != null and rmBody.length > 0">
				, `body` = #{rmBody}
			</if>
			<if test="rmRoleType != null and rmRoleType.length > 0">
				, `roleType` = #{rmRoleType}
			</if>
			<if test="rmPay != null and rmPay.length > 0">
				, `pay` = #{rmPay}
			</if>
			<if test="rmLocation != null and rmLocation.length > 0">
				, `location` = #{rmLocation}
			</if>
			<if test="rmPeriod != null and rmPeriod.length > 0">
				, `period` = #{rmPeriod}
			</if>
			<if test="rmDeadline != null and rmDeadline.length > 0">
				, `deadline` = #{rmDeadline}
			</if>
			<if test="rmGender != null and rmGender.length > 0">
				, `gender` = #{rmGender}
			</if>
			<if test="rmAge != null and rmAge.length > 0">
				, `age` = #{rmAge}
			</if>
			<if test="rmScript != null and rmScript.length > 0">
				, `script` = #{rmScript}
			</if>
			<if test="rmVideoTime != null and rmVideoTime.length > 0">
				, `videoTime` = #{rmVideoTime}
			</if>
			<if test="rmEtc != null and rmEtc.length > 0">
				, `etc` = #{rmEtc}
			</if>
		</set>
		WHERE id = #{recruitmentId} 
		AND memberId = #{memberId}
	</update>
	
	<select id="getRecruitsCount" resultType="int">
		SELECT COUNT(*) FROM recruitment
		WHERE delStatus != 1
	</select>
	
	<select id="getRecruitByLimit" resultType="Recruit">
		SELECT * FROM recruitment
		WHERE delStatus != 1
		LIMIT #{limitStart} , 1
	</select>
	
	<select id="getRecruitForPrintById" resultType="Recruit">
		SELECT r.*,
		aw.media AS extra__aw_media, 
		aw.title AS extra__aw_title,
		aw.subtitle AS extra__aw_subtitle,
		aw.genre AS extra__aw_genre, 
		aw.director AS extra__aw_director,
		aw.producer AS extra__aw_producer, 
		aw.writer AS extra__aw_writer,
		aw.castingManager AS extra__aw_castingManager, 
		aw.story AS extra__aw_story,
		aw.corp AS extra__aw_corp, 
		aw.etc AS extra__aw_etc, 
		ar.realName AS extra__ar_realName,
		ar.name AS extra__ar_name,
		ar.age AS extra__ar_age,
		ar.job AS extra__ar_job,
		ar.gender AS extra__ar_gender,
		ar.scriptStatus AS extra__ar_scriptStatus,
		ar.scenesCount AS extra__ar_scenesCount,
		ar.shootingsCount AS extra__ar_shootingsCount, 
		ar.character AS extra__ar_character,
		ar.etc AS extra__ar_etc 
		FROM recruitment AS r
		INNER JOIN artwork AS aw
		ON aw.relTypeCode = 'recruitment'
		AND aw.relId = r.id
		INNER JOIN actingRole AS ar
		ON ar.recruitmentId = r.id
		WHERE r.delStatus != 1
		AND r.id = #{id}
	</select>
	
	<select id="getListForPrintByKeyword" resultType="Recruit">
		SELECT r.*, aw.media AS extra__aw_media, aw.title AS extra__aw_title, aw.director AS extra__aw_director, ar.name AS extra__ar_name, ar.character AS extra__ar_character FROM recruitment AS r
		INNER JOIN artwork AS aw
		ON aw.relTypeCode = 'recruitment'
		AND aw.relId = r.id
		INNER JOIN actingRole AS ar
		ON ar.recruitmentId = r.id
		WHERE r.delStatus != 1
		<if test="keyword != null">
			AND ( 0
		</if>
		<if test="keyword != null">
			OR r.title LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.body LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.roleType LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.pay LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.location LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.period LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.deadline LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.gender LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.age LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.script LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.videoTime LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR r.etc LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.title LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.subtitle LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.media LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.genre LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.corp LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.director LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.producer LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.castingManager LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.writer LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.story LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR aw.etc LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR ar.realName LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR ar.name LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR ar.age LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR ar.job LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR ar.gender LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR ar.scriptStatus LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR ar.scenesCount LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR ar.shootingsCount LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR ar.character LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			OR ar.etc LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="keyword != null">
			)
		</if>
		ORDER BY id DESC
		<if test="limit != null">
		LIMIT #{limit}
		</if>
	</select>
	
</mapper>